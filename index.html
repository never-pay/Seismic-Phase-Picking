<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°éœ‡æ³¢æ‹¾å–ç®—æ³•æ€§èƒ½åŠ¨æ€æ¦œå•</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .up-good { color: #10b981; } /* ç»¿è‰² */
        .up-bad { color: #ef4444; }  /* çº¢è‰² */
        .delta { font-size: 0.7rem; margin-left: 2px; font-weight: bold; white-space: nowrap;}
        [v-cloak] { display: none; }
        .best-model { background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706); }
    </style>
</head>
<body class="bg-slate-50 p-4 md:p-10">
    <div id="app" v-cloak class="max-w-7xl mx-auto">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-black text-slate-800">Phase Picking Leaderboard</h1>
                <p class="text-sm text-slate-500">Comparing multiple datasets against model benchmarks</p>
            </div>
            
            <!-- ç­›é€‰å™¨ -->
            <div class="flex flex-wrap gap-4 mt-4 bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                <!-- æ¨¡å‹é€‰æ‹©å™¨ -->
                <div class="flex items-center">
                    <span class="text-xs font-bold mr-2 text-slate-400">MODEL</span>
                    <select v-model="selectedModel" class="text-sm font-bold text-purple-600 bg-purple-50 border-none rounded p-1">
                        <option v-for="model in availableModels" :key="model" :value="model" :class="model === 'Best in Class (ç»¼åˆæœ€ä¼˜)' ? 'font-bold' : ''">
                            {{ model }}
                        </option>
                    </select>
                </div>
                
                <!-- ç›¸ä½é€‰æ‹©å™¨ -->
                <div class="flex items-center border-l pl-4">
                    <span class="text-xs font-bold mr-2 text-slate-400">PHASE</span>
                    <select v-model="selectedPhase" class="text-sm font-bold text-blue-600 bg-blue-50 border-none rounded p-1">
                        <option value="P">P-phase</option>
                        <option value="S">S-phase</option>
                    </select>
                </div>
                
                <!-- é˜ˆå€¼é€‰æ‹©å™¨ -->
                <div class="flex items-center border-l pl-4">
                    <span class="text-xs font-bold mr-2 text-slate-400">THRESHOLD</span>
                    <select v-model="selectedThreshold" class="text-sm font-bold text-blue-600 bg-blue-50 border-none rounded p-1">
                        <option v-for="t in thresholds" :key="t" :value="t">{{ t.toFixed(2) }}</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- è¡¨æ ¼å®¹å™¨ -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200">
            <table class="min-w-full divide-y divide-slate-200 text-sm">
                <thead class="bg-slate-800 text-white">
                    <tr>
                        <th class="px-4 py-4 font-bold text-center w-16">Rank</th>
                        <th class="px-4 py-4 font-bold text-left">Test Datasets</th>
                        <th v-for="m in metrics" :key="m" class="px-2 py-4 font-bold text-center uppercase text-[10px] tracking-wider">
                            {{ m }}
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200">
                    <!-- åŸºå‡†è¡Œ -->
                    <tr :class="selectedModel === 'Best in Class (ç»¼åˆæœ€ä¼˜)' ? 'best-model' : 'bg-amber-50'">
                        <td class="px-4 py-3 text-center">
                            <span v-if="selectedModel === 'Best in Class (ç»¼åˆæœ€ä¼˜)'">ğŸ†</span>
                            <span v-else>ğŸ“Š</span>
                        </td>
                        <td class="px-4 py-3 font-bold" 
                            :class="selectedModel === 'Best in Class (ç»¼åˆæœ€ä¼˜)' ? 'text-white' : 'text-amber-800'">
                            {{ selectedModel }}
                        </td>
                        <td v-for="m in metrics" :key="m" class="px-2 py-3 text-center font-mono font-bold"
                            :class="selectedModel === 'Best in Class (ç»¼åˆæœ€ä¼˜)' ? 'text-white' : 'text-slate-600'">
                            {{ getBenchmarkValue(m).toFixed(4) }}
                        </td>
                    </tr>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <tr v-if="loading">
                        <td :colspan="metrics.length + 2" class="py-10 text-center text-slate-400">Loading datasets...</td>
                    </tr>

                    <!-- åŠ¨æ€æ•°æ®é›†ç»“æœ -->
                    <tr v-for="(ds, idx) in processedResults" :key="ds.name" class="hover:bg-blue-50 transition-colors">
                        <td class="px-4 py-4 text-center font-bold text-slate-300">#{{ idx + 1 }}</td>
                        <td class="px-4 py-4 font-bold text-slate-700">{{ ds.name }}</td>
                        <td v-for="m in metrics" :key="m" class="px-1 py-4 text-center">
                            <div class="font-mono text-slate-800">{{ ds.values[m] ? ds.values[m].toFixed(4) : '-' }}</div>
                            <!-- å·®å€¼è®¡ç®— -->
                            <div v-if="ds.values[m]" 
                                 :class="getDeltaStyle(m, ds.values[m])" 
                                 class="delta">
                                {{ (ds.values[m] - getBenchmarkValue(m)) >= 0 ? '+' : '' }}{{ (ds.values[m] - getBenchmarkValue(m)).toFixed(4) }}
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loading: true,
                    selectedModel: 'Best in Class (ç»¼åˆæœ€ä¼˜)',
                    selectedPhase: 'P',
                    selectedThreshold: 0.10,
                    metrics: ['Precision', 'Recall', 'F1', 'H', 'o', 'MAE', 'RMSE', 'R2', 'IoU'],
                    thresholds: [0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95],
                    
                    datasetConfigs: [
                        { name: 'ETHZ Dataset', url: './data/ethz.json' },
                        { name: 'PNW Dataset', url: './data/pnw.json' },
                        { name: 'SCEDC Dataset', url: './data/scedc.json' }
                    ],
                    
                    benchmarks: {},
                    availableModels: [] // ä»æ•°æ®ä¸­åŠ¨æ€ç”Ÿæˆ
                }
            },
            computed: {
                processedResults() {
                    return this.allData.map(ds => {
                        const row = ds.content.find(d => 
                            d.Phase === this.selectedPhase && 
                            Math.abs(d.Threshold - this.selectedThreshold) < 0.001
                        );
                        return { name: ds.name, values: row || {} };
                    });
                }
            },
            methods: {
                async init() {
                    try {
                        // 1. åŠ è½½åŸºå‡†æ•°æ®
                        const bRes = await fetch('./benchmarks.json');
                        this.benchmarks = await bRes.json();

                        // 2. ä»æ•°æ®ä¸­ç”Ÿæˆæ¨¡å‹åˆ—è¡¨
                        this.generateModelList();

                        // 3. å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®é›†
                        const fetchPromises = this.datasetConfigs.map(async (cfg) => {
                            const res = await fetch(cfg.url);
                            const content = await res.json();
                            return { name: cfg.name, content: content };
                        });

                        this.allData = await Promise.all(fetchPromises);
                        this.loading = false;
                    } catch (err) {
                        console.error("åŠ è½½æ•°æ®å¤±è´¥:", err);
                    }
                },
                generateModelList() {
                    // ä»åŸºå‡†æ•°æ®ä¸­æå–æ‰€æœ‰æ¨¡å‹å
                    const modelNames = new Set();
                    
                    // æ·»åŠ æ‰€æœ‰å®é™…æ¨¡å‹
                    Object.values(this.benchmarks.models[this.selectedPhase] || {}).forEach(model => {
                        if (model.name) modelNames.add(model.name);
                    });
                    
                    // å°†æ¨¡å‹åè½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                    const models = Array.from(modelNames).sort();
                    
                    // æ·»åŠ "Best in Class"é€‰é¡¹åˆ°æœ€å‰é¢
                    this.availableModels = ['Best in Class (ç»¼åˆæœ€ä¼˜)', ...models];
                },
                getBenchmarkValue(metric) {
                    const phaseData = this.benchmarks[this.selectedPhase] || {};
                    
                    if (this.selectedModel === 'Best in Class (ç»¼åˆæœ€ä¼˜)') {
                        // ç›´æ¥ä»åŸºå‡†æ•°æ®ä¸­è·å–bestå€¼
                        const bestModel = phaseData.find(m => m.name === 'Best in Class');
                        return bestModel ? bestModel[metric] : 0;
                    } else {
                        // æŸ¥æ‰¾ç‰¹å®šæ¨¡å‹
                        const modelData = phaseData.find(m => m.name === this.selectedModel);
                        return modelData ? modelData[metric] : 0;
                    }
                },
                getDeltaStyle(metric, value) {
                    const bench = this.getBenchmarkValue(metric);
                    const diff = value - bench;
                    const lowerIsBetter = ['H', 'o', 'MAE', 'RMSE', 'R2'];
                    
                    // æ³¨æ„ï¼šR2å€¼è¶Šå¤§è¶Šå¥½ï¼Œä½†è¡¨ä¸­R2æ˜¯è´Ÿå€¼ï¼Œæ‰€ä»¥å¤„ç†æ–¹å¼ä¸åŒ
                    if (metric === 'R2') {
                        return diff >= 0 ? 'up-good' : 'up-bad';
                    }
                    
                    if (lowerIsBetter.includes(metric)) {
                        // å¯¹äºHå’Œoï¼šç»å¯¹å€¼è¶Šå°è¶Šå¥½
                        if (metric === 'H' || metric === 'o') {
                            return Math.abs(value) <= Math.abs(bench) ? 'up-good' : 'up-bad';
                        }
                        // å¯¹äºMAEã€RMSEï¼šå€¼è¶Šå°è¶Šå¥½
                        return diff <= 0 ? 'up-good' : 'up-bad';
                    }
                    // Precision, Recall, F1, IoUï¼šå€¼è¶Šå¤§è¶Šå¥½
                    return diff >= 0 ? 'up-good' : 'up-bad';
                }
            },
            watch: {
                selectedPhase() {
                    // å½“ç›¸ä½æ”¹å˜æ—¶ï¼Œé‡æ–°ç”Ÿæˆæ¨¡å‹åˆ—è¡¨
                    if (this.benchmarks) {
                        this.generateModelList();
                    }
                }
            },
            mounted() {
                this.init();
            }
        }).mount('#app')
    </script>
</body>
</html>